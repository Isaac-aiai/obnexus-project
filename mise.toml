# See claude code environment variables documents at https://code.claude.com/docs/en/settings
[env]

[tools]
claude = "latest"
python = "3.12"
ruff = "latest"
uv = "latest"
node = "24"
pnpm = "latest"

# === Tasks
[tasks.venv-create]
description = "âœ¨ Create Python virtual environment (.venv)"
run = "uv venv"

[tasks.venv-remove]
description = "ğŸ’¥ Remove Python virtual environment folder (.venv)"
run = "rm -r .venv"

[tasks.inst-python-deps]
description = "ğŸ’¾ Install Python dependencies via uv"
run = "uv sync --all-extras"

[tasks.inst-node-deps]
description = "ğŸ“¦ Install Node.js dependencies via pnpm"
run = "pnpm install"

[tasks.inst]
description = "ğŸ’¾ Install all dependencies (Python + Node.js)"
depends = ["inst-python-deps", "inst-node-deps"]

[tasks.download-db]
description = "ğŸ“¥ Download SQLite database file from GitHub Release"
run = ".venv/bin/python scripts/test_download_sqlite_file.py"

[tasks.export]
description = "ğŸ’¾ Export Core Python dependencies to requirements.txt via uv"
run = "uv export --format requirements-txt --no-dev --no-emit-project --no-hashes --no-annotate --no-emit-package pywin32 --no-emit-package colorama --no-emit-package tzdata | sed 's/ ; platform_machine ==.*or.*//' > requirements.txt"

[tasks.test-python]
description = "ğŸ§ª Run Python tests with pytest"
run = ".venv/bin/pytest tests_python"

[tasks.test-node]
description = "ğŸ§ª Run Node.js tests"
run = "node --test tests_node/*.test.js"

[tasks.test]
description = "ğŸ§ª Run all tests (Python + Node.js)"
depends = ["test-python", "test-node"]

[tasks.cov-python]
description = "ğŸ§ª Run Python code coverage tests with pytest"
run = ".venv/bin/pytest tests_python -s --tb=native --cov=obnexus --cov-report term-missing --cov-report html:htmlcov"

[tasks.cov]
description = "ğŸ§ª Run all code coverage tests (Python + Node.js)"
depends = ["cov-python"]

[tasks.next-dev]
description = "ğŸŒ Start Next.js development server"
run = "next dev"

[tasks.fastapi-dev]
description = "âš™ï¸ Start FastAPI development server"
run = "uv run -- python -m uvicorn api.index:app --reload --host 127.0.0.1 --port 8000"

[tasks.dev]
description = "ğŸš€ Start all development servers (Next.js + FastAPI)"
depends = ["kill"]
run = "pnpm exec concurrently 'mise run next-dev' 'mise run fastapi-dev'"

[tasks.kill]
description = "ğŸ›‘ Kill all development servers (Next.js + FastAPI)"
run = "uv run -- python kill-dev-servers.py"
